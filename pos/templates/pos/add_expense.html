{% extends 'pos/base.html' %}
{% load static %}

{% block title %}Edit Expense{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto bg-white rounded-lg shadow overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-200 bg-blue-600">
        <h2 class="text-xl font-semibold text-white">
            <i class="fas fa-edit mr-2"></i> Edit Expense
        </h2>
    </div>
    
    <form method="post" class="px-6 py-4" id="expenseForm">
        {% csrf_token %}
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <div class="mb-4">
                    <label for="{{ form.date.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                        Date <span class="text-red-500">*</span>
                    </label>
                    <input type="date" id="{{ form.date.id_for_label }}" name="{{ form.date.name }}" 
                           value="{{ form.date.value|date:'Y-m-d' }}" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    {% if form.date.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.date.errors }}</p>
                    {% endif %}
                </div>
                
                <div class="mb-4">
                    <label for="{{ form.category.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                        Category <span class="text-red-500">*</span>
                    </label>
                    <select id="{{ form.category.id_for_label }}" name="{{ form.category.name }}" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        {% for choice in form.category.field.choices %}
                            <option value="{{ choice.0 }}" {% if form.category.value == choice.0 %}selected{% endif %}>
                                {{ choice.1 }}
                            </option>
                        {% endfor %}
                    </select>
                    {% if form.category.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.category.errors }}</p>
                    {% endif %}
                </div>
            </div>
            
            <div>
                <div class="mb-4">
                    <label for="{{ form.amount.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                        Amount <span class="text-red-500">*</span>
                    </label>
                    <div class="relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">$</span>
                        </div>
                        <input type="number" id="{{ form.amount.id_for_label }}" name="{{ form.amount.name }}" 
                               value="{{ form.amount.value }}" step="0.01" min="0" required
                               class="block w-full pl-7 pr-12 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    {% if form.amount.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.amount.errors }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="mb-4">
            <label for="{{ form.description.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                Description
            </label>
            <textarea id="{{ form.description.id_for_label }}" name="{{ form.description.name }}" rows="3"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">{{ form.description.value|default:'' }}</textarea>
        </div>
        
        <div class="flex justify-end space-x-3">
            <a href="{% url 'expense_list' %}" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                <i class="fas fa-times mr-1"></i> Cancel
            </a>
            <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                <i class="fas fa-save mr-1"></i> Update Expense
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    // Form validation
    $("#expenseForm").validate({
        rules: {
            date: "required",
            category: "required",
            amount: {
                required: true,
                min: 0.01
            }
        },
        messages: {
            date: "Please select date",
            category: "Please select category",
            amount: {
                required: "Please enter amount",
                min: "Amount must be greater than 0"
            }
        },
        errorElement: 'span',
        errorPlacement: function (error, element) {
            error.addClass('text-red-600 text-sm mt-1');
            error.insertAfter(element);
        },
        highlight: function (element, errorClass, validClass) {
            $(element).addClass('border-red-500').removeClass('border-gray-300');
        },
        unhighlight: function (element, errorClass, validClass) {
            $(element).removeClass('border-red-500').addClass('border-gray-300');
        }
    });
});
</script>
{% endblock %}